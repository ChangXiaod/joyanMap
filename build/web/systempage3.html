<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>系统管理</title>
        <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!--external css-->
        <link href="lib/bootstrap/css/font-awesome.css" rel="stylesheet" />
        <!-- Custom styles for this template -->
        <link href="css/style.css" rel="stylesheet">
        <link href="css/style-responsive.css" rel="stylesheet">
        <link rel="stylesheet" href="lib/bootstrap/css/bootstrap-table.css">
        <link href="lib/bootstrap/css/jquery-confirm.min.css" rel="stylesheet" type="text/css"/>
        <script src="lib/jquery/jquery.min.js"></script>
        <script src="lib/bootstrap/js/bootstrap.min.js"></script>
        <script src="lib/bootstrap/js/bootstrap-table.js" type="text/javascript"></script>
        <script src="lib/bootstrap/js/bootstrap-table-zh-CN.js"></script>
        <script src="lib/bootstrap/js/jquery-confirm.min.js" type="text/javascript"></script>
        <script src="lib/myjs.js" type="text/javascript"></script>
        <style>
            .p1{
                width: 33.33%;
            }
        </style>
    </head>

    <body>
        <div class="row tlbd" style="background: none;">
            <div class="col-md-4 ds tl">
                <div class="row">
                    <div class="col-md-12 col-sm-12" style="text-align: left;">
                        <div>
                            <label for="search">请输入搜索关键词：</label>
                            <input type="search" id="key" name="search" size="30" placeholder="请输入关键字" />
                            <input type="submit" class="btn-primary" onclick="searchByKey()"/>
                        </div>
                    </div>
                </div>	
            </div>
            <div class="col-md-6"></div>
            <div class="col-md-2 ds ttl"></div>
        </div>
        <div id = 'div_tab' class="row tl-p">				
            <table id="data_list" class="table table-striped table-bordered table-hover table-full-width">
            </table>
        </div>
        
         <!--删除用户弹窗提示-->
        <div id='delete_modal' class="modal fade" style="position: absolute; top: 30%;" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content" style="width: 400px; height: auto">
                    <div class="modal-header" style="background: #FFFFFF">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" style="text-align: center; color: #000000; font-weight: 600; font-size: 20px;" id="myModalLabel">
                            删除日志
                        </h4>
                        <div class="sign">
                            <img src="img/images/icon4-1.png">
                        </div>
                        <h4 style="text-align: center; color: #000000; font-size: 16px">
                            您将永久删除此日志，无法恢复，是否继续？
                        </h4>
                        <div class="sign">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button style='margin-left: 15px;' type="button" class="btn btn-primary" data-dismiss="modal"  onclick="submit_del()">确定</button>
                        </div>
                    </div>	
                </div>
            </div>
        </div>
        <div class="modal fade" style="position: absolute; top: 30%;" id="deSuccess" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content" style="width: 400px; height: auto">
                    <div class="modal-header" style="background: #FFFFFF">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                    </div>
                    <div class="sign">
                        <img src="img/images/icon4-3.png">
                    </div>
                    <div class="sign">
                        删除成功
                    </div>
                </div>
            </div>
        </div>
         
        <script type="text/javascript">
            var editId;

            $(function () {
                //设置表格区域的高度及宽度
                document.getElementById("div_tab").style.height = (screen.availHeight * 0.7 - 15) + 'px';
                document.getElementById("div_tab").style.margin = '20px 0 0 0';
                document.getElementById("div_tab").style.width = (screen.availWidth * 0.88) + 'px';
                //创建表
                initTable();
            });
            $('#key').keydown(function (event) {
                if (event.keyCode === 13) {
                    searchByKey();
                }
            });
            //根据关键字查询
            function searchByKey() {
                $('#data_list').bootstrapTable('removeAll');
                $('#data_list').bootstrapTable("refresh");
            }


            //初始化计划装设备表格
            function initTable() {
                $('#data_list').bootstrapTable('removeAll');
                $('#data_list').bootstrapTable({
                    locale: 'zh-CN',
                    pagination: true, //分页功能
                    pageNumber: 1, //初始页面
                    pageSize: 20, //每页行数
                    pageList: [20, 50, 100],
                    smartDisplay: true,
                    clickToSelect: true, //是否启用点击选中行
                    sidePagination: "server", //后台分页
                    method: 'get',
                    url: 'QueryDataServlet',
                    dataField: 'data',
                    queryParams: queryParams, //传给后台的查询参数
                    responseHandler: responseHandler, //查询成功后执行方法
                    columns: [
                        {
                            title: '序号', //标题  可不加  
                            formatter: function (value, row, index) {
                                return index + 1;
                            }
                        },
                        {
                            title: '用户编号',
                            field: 'user_id'
                        },
                        {
                            title: '用户名',
                            field: 'user_name'
                        },
                        {
                            title: '真实姓名',
                            field: 'real_name'
                        },
                        {
                            title: '操作类型',
                            field: 'operation'
                        },
                        {
                            title: '日志',
                            field: 'log'
                        },
                        {
                            title: '操作',
                            field: 'id',
                            formatter: operateFormatter
                        }
                    ]
                });
            }


            //请求成功方法
            function responseHandler(mdata) {
                var errcode = mdata.code;//在此做了错误代码的判断
//                alert(JSON.stringify(mdata));
                if (errcode != 0) {
                    $.alert({
                        title: '告警',
                        content: "对不起，获取数据失败！",
                    });
                    return;
                }
                //缓存数据
                sessionStorage.useritems = JSON.stringify(mdata.result.data);
                //如果没有错误则返回数据，渲染表格
                return {
                    total: mdata.result.total, //总页数,前面的key必须为"total"
                    data: mdata.result.data //行数据，前面的key要与之前设置的dataField的值一致.
                };
            }

            //生成表格中按钮
//            function operateFormatter(value, row, index) {
//                return ["<a href='#'  title='编辑'><i class='icon-edit moveicon-left' style='color: #01bbd4'>编辑</i></a>\n\
//                        <a href='javascript:del(" + row.id + ")' title='删除'><i class='icon-remove moveicon-middle' style='color: #01bbd4'>删除</i></a>"].join('');
//            }
            function operateFormatter(value, row, index) {
                return ["<a href='javascript:del(" + row.id + ")' title='删除'><i class='icon-remove moveicon-middle' style='color: #01bbd4'>删除</i></a>"];
            }
            //请求服务数据时所传参数
            function queryParams(params) {
                //获取查询关键字
                var key = document.getElementById("key").value;


                //返回查询参数
                return{
                    //每页多少条数据
                    rows: params.limit,
                    //请求第几页
                    page: params.pageNumber,
                    sid: "get_log",
                    order: "update_time",
                    desc: "false",
                    key: key
                }
            }

            //删除日志确认
            function del(id) {
                $('#delete_modal').modal('show');
                editId = id;
            }
            //正式删除日志
            function submit_del() {
                var params = {};
                params.sid = "delete_log";
                params.condition = "id = " + editId;
                $.post("DeleteDataServlet", params, function (mdata) {
                    $('#delete_modal').modal('hide');
                    var data = JSON.parse(mdata);
                    if (data.code == 0) {
                        //成功
                        $('#deSuccess').modal('show');
                        //重新加载数据
                        searchByKey();
                    } else {
                        $.alert({
                            title: '提示!',
                            content: data.info,
                        });
                    }
                });
            }
            
           



        </script> 
    </body>

</html>
