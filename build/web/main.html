<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE9" />
        <title>西安公安十四运安保平台</title>
        <link href="img/favicon.ico" rel="icon">
        <!-- Bootstrap core CSS -->
        <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!--external css-->
        <link href="lib/font-awesome/css/font-awesome.css" rel="stylesheet" />
        <link href="lib/bootstrap/css/jquery-confirm.min.css" rel="stylesheet" type="text/css"/>
        <!-- Custom styles for this template -->
        <link href="css/style.css" rel="stylesheet">
        <link href="css/style-responsive.css" rel="stylesheet">
        <script src="lib/jquery/jquery.min.js"></script>
        <script src="lib/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="lib/bootstrap/js/jquery-confirm.min.js" type="text/javascript"></script>
        <script src="lib/myjs.js" type="text/javascript"></script>
        <style>
            /* .wrapper {
                margin-top: 60px; 为了适应noframe 
            }
            #main-content {
                width: 92%;
                margin-left: 7%;
            } */

            .l2.active, .l2:hover, .l2:focus {
                background: #004080;
                color: #fff;
                /* display: block; */

                -webkit-transition: all 0.3s ease;
                -moz-transition: all 0.3s ease;
                -o-transition: all 0.3s ease;
                -ms-transition: all 0.3s ease;
                transition: all 0.3s ease;
            }
        </style>

    </head>

    <body >
        <section id="container">
            <!-- **********************************************************************************************************************************************************
                TOP BAR CONTENT & NOTIFICATIONS
                *********************************************************************************************************************************************************** -->
            <!--header start-->
            <header class="header black-bg">

                <div class="container top_container"><!-- style="background-color:#3278c1;" -->
                    <div class="row">
                        <div class="col-md-1 hidden-sm hidden-xs" style="height: 80px;"><img src="img/Framework/badge.png"></div>
                        <div class="col-md-6 3c"><span class="mytext">西安公安十四运安保平台</span></div>
                        <div class="col-md-3 hidden-md hidden-sm hidden-xs" style="height: 80px;">
                            <div class="row">
                                <div class="col-md-5" style="height:80px;"><img style="margin-top: 16px;float:right;" src="img/Framework/icon-soldier.png"></div>
                                <div class="col-md-5" style="height:80px;text-align: left;">
                                    <span style="margin-top: 16px;" class="soldier_name" id="show_account">李教导</span>
                                    <span style="margin-top: 16px;" class="soldier_name" id="current_time">2021年09月21</span>
                                </div>
                                <div class="col-md-2" style="height:80px;">
                                    <button type="button" class="btn btn-primary dropdown-toggle bt-down" data-toggle="dropdown">
                                        <img src="img/Framework/bt_b.png">
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li>
                                            <a class="pulldown" href="repinformationpage_noframe.html" target="content_frame">
                                                <span class="glyphicon glyphicon-user">&nbsp账号信息</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="pulldown" href="repassword_noframe.html" target="content_frame">
                                                <span class="glyphicon glyphicon-lock">&nbsp修改密码</span>
                                            </a>
                                        </li>
                                    </ul>

                                </div>
                            </div>
                        </div>
                        <div class="col-md-2 hidden-md hidden-sm hidden-xs" style="height: 80px;">
                            <div class="row">
                                <div class="col-md-4"></div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-primary bt_exit" onclick="logout()" >
                                        <span><img src="img/Framework/logout.png"></span>
                                        <br>
                                        <span style="font-size:16px;">退出登录</span>
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </header> 


            <!--header end-->
            <!-- **********************************************************************************************************
                MAIN SIDEBAR MENU 主体左侧的导航条菜单部分
                *********************************************************************************************************** -->
            <!--sidebar start-->
            <style>
                ul li a span img{
                    height: 30px;
                }
            </style>
            <aside>
                <div id="sidebar" class="nav-collapse ">
                    <!-- sidebar menu start 左侧的导航条菜单部分-->
                    <ul class="sidebar-menu" id="nav-accordion">

                        <!-- <li class="homepage l1">
                            <a class="l2" href="homepage_noframe.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/01.png"><br>首页</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li> -->
                        <li class="map l1">
                            <!-- <a class="l2" href="map.html" target="content_frame"> -->
                            <a class="l2" href="copy_police.html" target="_blank">
                                <span>&nbsp<img src="img/Framework/06.png"><br>警力一张图</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        <!-- <li class="orgnization l1"> 
                            <a class="l2" href="organizationpage_noframe.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/06.png"><br>警力一张图</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li> -->
                        <li class="people l1">
                            <a class="l2" href="personnelpage_noframe.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/02.png"><br>警员管理</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        <li class="preplay l1">
                            <a class="l2" href="blank.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/03.png"><br>轨迹回放</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        <li class="map l1">
                            <!-- <a class="l2" href="map.html" target="content_frame"> -->
                            <a class="l2" href="map.html" target="_blank">
                                <span>&nbsp<img src="img/Framework/04.png"><br>地图标绘</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        <li class="support l1">
                            <a class="l2" href="police_deployed.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/05.png"><br>警力部署</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        
                        
                        <li class="equipment l1">
                            <a class="l2" href="venue_management.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/07.png"><br>场馆管理</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        <!-- <li class="performance l1">
                            <a class="l2" href="blank.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/08.png"><br>想定推演</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        
                        <li class="video l1">
                            <a class="l2" href="videopage_noframe.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/video.png"><br>监控视频</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li> -->
                        
                        <li class="mychart l1">
                            <a class="l2" href="chartpage_noframe.html" target="content_frame">
                                <span>&nbsp<img src="img/Framework/chart.png"><br>统计报表</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>
                        <li class="setting l1">
                            <a class="l2" href="systempage_noframe.html" target="content_frame" >
                                <span>&nbsp<img src="img/Framework/setting.png"><br>系统设置</span>
                                <span class="triangle"><img src="img/Framework/triangle.png"></span>
                            </a>
                        </li>

                    </ul>
                    <!-- sidebar menu end-->
                </div>
            </aside> 
            <!--sidebar end-->
            <!-- **********************************************************************************************************************************************************
                MAIN CONTENT
                *********************************************************************************************************************************************************** -->
            <section style="width:92%;margin-left: 9%;">
                <section class="wrapper" style="margin-top: 3%;">
                    <iframe src="personnelpage_noframe.html" id="content_frame" name="content_frame" style=" width:100%;height:100%;" scrolling="no" frameborder="0"></iframe>
                </section>
            </section>  
        </section>
        <script>
            document.getElementById("content_frame").style.height = document.documentElement.clientHeight * 0.92 + "px";
            var global_menu = new HashMap();
            $(function () {
                //初始化界面菜单
//                App.init(); // initlayout and core plugins
//                if (document.all) { window.resizeTo(screen.availWidth,screen.availHeight);
                //显示登录信息
                $.post("QuerySessionServlet", null, function (data) {
//                    alert(data);
                    var mdata = JSON.parse(data);
                    if (mdata.code == 0) {
                        sessionStorage.setItem("session_key", mdata.session.userName);
                        sessionStorage.setItem("name", mdata.session.name);
                        sessionStorage.setItem("login_depart", mdata.session.departSID);
                  
                        sessionStorage.setItem("org_name", mdata.session.org_name);
                        sessionStorage.setItem("login_account", mdata.session.userName);
                        sessionStorage.setItem("realName", mdata.session.realName);
                        sessionStorage.setItem("role_id", mdata.session.roleIDS);
                        $('#show_account').text(mdata.session.realName);
                        $("#content_frame").scrollTop(window.innerHeight);
                        //显示当前时间
                        show_time();
                        //根据用户权限，初始化左侧的导航菜单
                        initMenu();
                    } else {
                        $.alert({
                            title: '提示!',
                            content: "对不起，会话失效，请重新登录！",
                        });
                        //转跳到登录页面
                        location.href = "index.html";
                    }
                });
            });

            //显示当前日期
            function show_time() {
                var date = new Date();
//                var weekDay = ["星期天", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
                var year = date.getFullYear();
                var month = date.getMonth() + 1;
                var day = date.getDate();
//                var week = weekDay[date.getDay()];
                $("#current_time").html(year + "年" + month + "月" + day + "日&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp");
            }

            //初始化菜单
            function initMenu() {
                var params = {};
                params.sid = "get_role";
                //默认为第一个职位
                var roles = sessionStorage.getItem("role_id");//获得保存的职位信息
                if (roles != null && roles != undefined && roles != "") {
                    params.role_id = roles;
                    //params.condition="id in(13,14)"
                } else {
                    //如果没有职位定义，则返回
                    return;
                }

                //调用查询服务  查询这个ID下应该显示什么菜单
                $.post("QueryMenu", params, function (mdata) {
//                    mdata这个职位下应该显示的菜单
                    var data = JSON.parse(mdata);
                    if (data.code == 0) {
                        //默认加载第一个职位
                        var items = JSON.parse(data.result[0].resource);
//                        alert(JSON.stringify(items));
                        updateMenu(items);//更新左边菜单
                    }
                });
            }

            //更新菜单
            function updateMenu(items) {
                if (items != null && items != undefined) {
                    //动态添加菜单
                    var menu_html = "";
                    var i = 0;
                    //全局变量，暂时保存重新归并后的菜单项
                    var menu_hash = resortMenu(items);
                    for (; i < items.length; i++) {
                        //单个node
                        var item = items[i];
//                           alert(JSON.stringify(item));
                        //判断node的类型，如果是一级菜单，直接生成菜单
                        if (item.parentid == '0') {
                            var menu = menu_hash.get(item.id);
                            var submenu = menu.submenu;
                            //有子菜单的情况
                            if (submenu != null && submenu != undefined) {
                                menu_html += "<li class=\"dropdown\">\n\
                                                <a class=\"dropdown-toggle\" data-toggle=\"dropdown\" href=\"#\"  style=\"color:white;font-size:10pt;\">\n\
                                                  " + item.name + "\n\
                                                  <span class=\"caret \"></span>\n\
                                                </a><ul class=\"dropdown-menu\">";

                                var j = 0;
                                for (; j < submenu.length; j++) {
                                    var sub = submenu[j];
//                                     alert(sub.url); 
//                                    if (sub.url == "hn_1st_train_code.html"
//                                            || sub.url == "hn_1st_fanche_monitor.html"
//                                            || sub.url == "hn_1st_train_code.html"
//                                            || sub.url == "hn_1st_fanche_monitor.html") {
//                                        menu_html += "<li>\n\
//                                                    <a href=\"" + sub.url + "\" target=\"content\" onclick=\"saveMenu(this)\">\n\
//                                                     " + sub.name + "</a></li>";
//                                    } else {
                                    menu_html += "<li>\n\
                                                    <a href=\"" + sub.url + "\" target=\"content\" onclick=\"saveMenu('" + item.name + "','" + sub.name + "')\">\n\
                                                     " + sub.name + "</a></li>";
//                                    }
                                    // alert(menu_html);
                                }

                                menu_html += "</ul></li>";

                            } else {
//                                if (item.url == "hn_1st_train_code.html"
//                                        || item.url == "hn_1st_fanche_monitor.html"
//                                        || item.url == "hn_1st_train_code.html"
//                                        || item.url == "hn_1st_fanche_monitor.html") {
//                                    menu_html += "<li class=\"\">\n\
//                                             <a href=\"" + (item.url == "" ? "" : item.url) + "\" target=\"content\" \n\
//                                             style=\"color:white;font-size:10pt;\" onclick=\"saveMenu(this)\">" + item.name + "</a></li>";
//                                } else {
                                menu_html += "<li class=\"\">\n\
                                             <a href=\"" + (item.url == "" ? "" : item.url) + "\" target=\"content\" \n\
                                             style=\"color:white;font-size:10pt;\" onclick=\"saveMenu('" + item.name + "','" + item.name + "')\">" + item.name + "</a></li>";
//                                }

                                //  alert(menu_html);
                            }
                        }
                    }
//                      alert(menu_html);
//                    document.getElementById("menu_list").innerHTML = menu_html;
                }
            }

            //显示当前位置
            function saveMenu(item_name, sub_name) {
                //参数非空检查
                if (item_name == undefined || sub_name == undefined) {
                    return true;
                }
                //显示目前的导航路径
                if (item_name == sub_name) {
                    $("#path").text(item_name);
                } else {
                    $("#path").text(item_name + "/" + sub_name);
                }
                return true;
            }

            //对菜单数据进行归并处理
            function resortMenu(items) {
                if (items != null && items != undefined) {
                    var i = 0;
                    //归并的主要目的是将菜单和子菜单集中到一起
                    var menu_hash = new HashMap();
                    for (; i < items.length; i++) {
                        var item = items[i];
                        if (item.parentid == 0) {//第一级菜单
                            menu_hash.put(item.id, item);
                        } else {
                            var menu = menu_hash.get(item.parentid);
                            if (menu != null && menu != undefined) {
                                //如果已经存在子菜单，就将这个子菜单添加进去
                                if (menu.submenu != null && menu.submenu != undefined) {
                                    menu.submenu.push(item);
                                } else {//如果还没有子菜单，就新建一个子菜单数组
                                    var submenu = [];
                                    submenu.push(item);
                                    menu.submenu = submenu;
                                }
                            }
                        }
                    }
                }
                //返回归并后的菜单
                return menu_hash;
            }

            function logout() {
                $.post('Logout', function (data) {
                    if (data == "success") {
                        location.href = "index.html";
                    } else {
                        alert("网络连接失败，请重新退出！");
                    }
                });
            }
        </script>
    </body>

</html>
